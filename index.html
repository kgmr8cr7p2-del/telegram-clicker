<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 24px; margin-bottom: 15px; }
        .stats { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); margin-bottom: 10px; }
        .stats div { margin: 5px 0; font-size: 16px; }
        .game-area { text-align: center; margin: 20px 0; }
        .click-button { background: linear-gradient(45deg, #FF6B6B, #FFE66D); border: none; border-radius: 50%; width: 150px; height: 150px; font-size: 18px; font-weight: bold; color: #333; cursor: pointer; transition: all 0.2s; box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4); display: block; margin: 0 auto; touch-action: manipulation; user-select: none; }
        .click-button:active { transform: scale(0.95); }
        .upgrades { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); margin-bottom: 10px; }
        .upgrades h3 { margin-bottom: 10px; text-align: center; }
        .upgrade-btn { width: 100%; padding: 10px; margin: 5px 0; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.2); color: white; cursor: pointer; font-size: 12px; transition: background 0.3s; }
        .upgrade-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .upgrade-btn:hover:not(:disabled) { background: rgba(255, 255, 255, 0.3); }
        .leaderboard { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); margin-bottom: 10px; }
        .leaderboard h3 { margin-bottom: 10px; text-align: center; }
        .leaderboard-item { padding: 10px 12px; margin: 5px 0; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); }
        .cooldown { pointer-events: none; opacity: 0.7; }
        .tab-buttons { display: flex; margin-bottom: 10px; gap: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.2); color: white; cursor: pointer; }
        .tab-btn.active { background: rgba(255, 255, 255, 0.4); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .autoclicker-info { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        .leaderboard-stats { text-align: center; margin-top: 10px; font-size: 12px; opacity: 0.8; }
        .server-status { text-align: center; font-size: 12px; margin-top: 5px; padding: 5px; border-radius: 5px; }
        .status-online { background: rgba(76, 175, 80, 0.3); color: #90EE90; }
        .status-offline { background: rgba(244, 67, 54, 0.3); color: #FF6B6B; }
        .loading { text-align: center; padding: 20px; font-size: 16px; }
        .refresh-btn { background: rgba(255, 255, 255, 0.2); border: none; border-radius: 8px; color: white; padding: 8px 15px; margin-top: 10px; cursor: pointer; font-size: 12px; }
        .reset-btn { background: rgba(255, 100, 100, 0.3); border: none; border-radius: 8px; color: white; padding: 8px 15px; margin: 5px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞... ‚è≥</div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzGhuJLb5BlJwNxDTQw4dtQ17bCnYe-tWM_MUQn5oChUVEqGgUupv1CMnrUBAm8w93l/exec';

        let gameState;
        let autoclickerInterval;

        function initTelegramApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App...');
            if (window.Telegram && Telegram.WebApp) {
                console.log('‚úÖ –í Telegram Web App');
                Telegram.WebApp.expand();
            }
            initGame();
        }

        function initGame() {
            console.log('üéÆ –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            createGameInterface();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            gameState = {
                score: 0,
                level: 1,
                clicksPerTap: 1,
                upgrades: { multiplier: 1, autoclicker: 0, autoclickerPower: 1 },
                lastClickTime: 0,
                clickCooldown: 100,
                leaderboard: [],
                totalPlayers: 0,
                serverOnline: false
            };

            autoclickerInterval = null;

            function getUserId() {
                if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe.user) {
                    return 'tg_' + Telegram.WebApp.initDataUnsafe.user.id;
                }
                return 'user_' + Math.random().toString(36).substr(2, 9);
            }

            function getPlayerName() {
                return window.Telegram?.WebApp?.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫';
            }

            // üì• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ü–†–û–ì–†–ï–°–°–ê –ü–†–ò –ó–ê–ü–£–°–ö–ï
            async function loadGameProgress() {
                try {
                    console.log('üì• –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞...');
                    
                    const response = await fetch(`${API_URL}?action=getLeaderboard&t=${Date.now()}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('üì® –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
                    
                    if (data && data.success) {
                        gameState.leaderboard = data.leaders || [];
                        gameState.totalPlayers = data.totalPlayers || 0;
                        gameState.serverOnline = true;
                        
                        // üéØ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –í–ê–® –ü–†–û–ì–†–ï–°–°
                        await restoreMyProgress();
                        
                        console.log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
                    } else {
                        throw new Error(data ? data.error : 'No data');
                    }
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                    gameState.serverOnline = false;
                }
                
                updateUI();
                startGameFeatures();
            }

            // üéØ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –í–ê–®–ï–ì–û –ü–†–û–ì–†–ï–°–°–ê –ò–ó –¢–ê–ë–õ–ò–¶–´ –õ–ò–î–ï–†–û–í
            async function restoreMyProgress() {
                try {
                    const playerName = getPlayerName();
                    const myBestResult = gameState.leaderboard.find(player => 
                        player.name === playerName
                    );
                    
                    if (myBestResult) {
                        console.log('üéØ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å:', myBestResult.score);
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—á–∫–∏
                        gameState.score = myBestResult.score;
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—á–∫–æ–≤
                        gameState.level = Math.max(1, Math.floor(gameState.score / 100) + 1);
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—á–∫–æ–≤
                        const calculatedClicks = Math.max(1, Math.pow(2, Math.floor(Math.log2(gameState.score / 1000))));
                        gameState.clicksPerTap = calculatedClicks;
                        
                        console.log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', {
                            score: gameState.score,
                            level: gameState.level,
                            clicksPerTap: gameState.clicksPerTap
                        });
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
                        showNotification(`–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! ${gameState.score.toLocaleString()} –æ—á–∫–æ–≤ ‚úÖ`);
                    } else {
                        console.log('‚ÑπÔ∏è –í—ã –Ω–æ–≤—ã–π –∏–≥—Ä–æ–∫, –Ω–∞—á–∏–Ω–∞–µ–º —Å 0');
                        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ù–∞—á–∏–Ω–∞–µ–º —Å –Ω–∞—á–∞–ª–∞ üéÆ');
                    }
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                }
            }

            function showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 10px;
                    z-index: 1000;
                    font-size: 14px;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 3000);
            }

            // üì§ –°–û–•–†–ê–ù–ï–ù–ò–ï –û–ß–ö–û–í –ù–ê –°–ï–†–í–ï–†
            async function saveScoreToServer(score) {
                try {
                    const playerName = getPlayerName();
                    const userId = getUserId();
                    
                    console.log('üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', playerName, score);
                    
                    const formData = new URLSearchParams();
                    formData.append('action', 'submitScore');
                    formData.append('name', playerName);
                    formData.append('score', score);
                    formData.append('userId', userId);
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data && data.success) {
                        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!');
                        gameState.serverOnline = true;
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                        await loadGameProgress();
                    } else {
                        throw new Error(data ? data.error : 'Save failed');
                    }
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    gameState.serverOnline = false;
                }
            }

            function updateUI() {
                const scoreElement = document.getElementById('score');
                const levelElement = document.getElementById('level');
                const clicksPerTapElement = document.getElementById('cpt');
                const autoclickerInfo = document.getElementById('autoclicker-info');
                const serverStatus = document.getElementById('server-status');
                
                if (scoreElement) scoreElement.textContent = gameState.score.toLocaleString();
                if (levelElement) levelElement.textContent = gameState.level;
                if (clicksPerTapElement) clicksPerTapElement.textContent = gameState.clicksPerTap.toLocaleString();
                
                if (autoclickerInfo) {
                    autoclickerInfo.textContent = `–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: +${(gameState.upgrades.autoclicker * gameState.upgrades.autoclickerPower).toLocaleString()}/—Å–µ–∫`;
                }
                
                if (serverStatus) {
                    serverStatus.textContent = gameState.serverOnline ? 'üü¢ –°–µ—Ä–≤–µ—Ä –æ–Ω–ª–∞–π–Ω' : 'üî¥ –°–µ—Ä–≤–µ—Ä –æ—Ñ–ª–∞–π–Ω';
                    serverStatus.className = gameState.serverOnline ? 'server-status status-online' : 'server-status status-offline';
                }
                
                updateUpgradeButtons();
                updateLeaderboard();
            }

            function handleClick(event) {
                const now = Date.now();
                const timeSinceLastClick = now - gameState.lastClickTime;
                if (timeSinceLastClick < gameState.clickCooldown) return;
                
                gameState.lastClickTime = now;
                const clickValue = gameState.clicksPerTap * gameState.upgrades.multiplier;
                gameState.score += clickValue;
                
                if (gameState.score >= gameState.level * 100) {
                    gameState.level++;
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
                    }
                }
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                saveScoreToServer(gameState.score);
                updateUI();
                
                const clickButton = document.getElementById('click-btn');
                if (clickButton) {
                    clickButton.style.transform = 'scale(0.95)';
                    setTimeout(() => clickButton.style.transform = 'scale(1)', 100);
                    clickButton.classList.add('cooldown');
                    setTimeout(() => clickButton.classList.remove('cooldown'), gameState.clickCooldown);
                }
            }

            function startAutoclicker() {
                if (autoclickerInterval) clearInterval(autoclickerInterval);
                if (gameState.upgrades.autoclicker > 0) {
                    autoclickerInterval = setInterval(() => {
                        const autoValue = gameState.upgrades.autoclicker * gameState.upgrades.autoclickerPower;
                        gameState.score += autoValue;
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–µ
                        if (gameState.score % 100 === 0) {
                            saveScoreToServer(gameState.score);
                        }
                        
                        updateUI();
                    }, 1000);
                }
            }

            function updateUpgradeButtons() {
                const upgrades = [
                    { id: 'click-power', cost: 150 },
                    { id: 'multiplier', cost: 50 },
                    { id: 'autoclicker', cost: 100 },
                    { id: 'autoclicker-power', cost: 200 }
                ];
                
                upgrades.forEach(upgrade => {
                    const btn = document.getElementById(`upgrade-${upgrade.id}`);
                    if (btn) {
                        btn.disabled = gameState.score < upgrade.cost;
                    }
                });
            }

            function setupUpgrades() {
                document.getElementById('upgrade-multiplier')?.addEventListener('click', function() {
                    const cost = 50;
                    if (gameState.score >= cost) {
                        gameState.score -= cost;
                        gameState.upgrades.multiplier *= 2;
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                        }
                        updateUI();
                    }
                });

                document.getElementById('upgrade-autoclicker')?.addEventListener('click', function() {
                    const cost = 100;
                    if (gameState.score >= cost) {
                        gameState.score -= cost;
                        gameState.upgrades.autoclicker += 1;
                        startAutoclicker();
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                        }
                        updateUI();
                    }
                });

                document.getElementById('upgrade-autoclicker-power')?.addEventListener('click', function() {
                    const cost = 200;
                    if (gameState.score >= cost) {
                        gameState.score -= cost;
                        gameState.upgrades.autoclickerPower *= 2;
                        startAutoclicker();
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                        }
                        updateUI();
                    }
                });

                document.getElementById('upgrade-click-power')?.addEventListener('click', function() {
                    const cost = 150;
                    if (gameState.score >= cost) {
                        gameState.score -= cost;
                        gameState.clicksPerTap *= 2;
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                        }
                        updateUI();
                    }
                });
            }

            function updateLeaderboard() {
                const leaderboardList = document.getElementById('leaderboard-list');
                
                if (leaderboardList) {
                    const currentPlayerName = getPlayerName();
                    
                    if (!gameState.serverOnline) {
                        leaderboardList.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #FF6B6B;">
                                ‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω<br>
                                <small>–ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è</small>
                            </div>
                        `;
                    } else if (gameState.leaderboard.length === 0) {
                        leaderboardList.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø—É—Å—Ç–∞!<br>
                                <small>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º –∏–≥—Ä–æ–∫–æ–º!</small>
                            </div>
                        `;
                    } else {
                        leaderboardList.innerHTML = gameState.leaderboard.map((player, index) => {
                            const isCurrentPlayer = (player.name === currentPlayerName);
                            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            const date = player.date ? new Date(player.date).toLocaleDateString('ru-RU') : '';
                            
                            return `
                                <div class="leaderboard-item" style="${isCurrentPlayer ? 'background: linear-gradient(90deg, rgba(255,215,0,0.3) 0%, rgba(255,215,0,0.1) 100%); border-left: 4px solid gold;' : ''}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="flex: 1;">
                                            <div style="font-weight: ${isCurrentPlayer ? 'bold' : 'normal'}; font-size: 14px;">
                                                ${medal} ${player.name} 
                                                ${isCurrentPlayer ? ' <span style="color: gold;">(–í—ã) üëë</span>' : ''}
                                            </div>
                                            <div style="font-size: 10px; opacity: 0.7; margin-top: 2px;">${date}</div>
                                        </div>
                                        <div style="font-weight: bold; font-size: 16px; color: #FFE66D; margin-left: 10px;">
                                            ${player.score.toLocaleString()}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }

                const statsElement = document.getElementById('leaderboard-stats');
                if (statsElement) {
                    if (gameState.serverOnline) {
                        statsElement.innerHTML = `–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${gameState.totalPlayers} üéÆ`;
                    } else {
                        statsElement.innerHTML = `–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω üî¥`;
                    }
                }
            }

            function setupTabs() {
                const tabButtons = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));
                        button.classList.add('active');
                        const tabName = button.getAttribute('data-tab');
                        document.getElementById(`${tabName}-tab`).classList.add('active');
                    });
                });
            }

            function resetGame() {
                if (confirm('üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É?\n–í—Å–µ –≤–∞—à–∏ –æ—á–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                    gameState = {
                        score: 0,
                        level: 1,
                        clicksPerTap: 1,
                        upgrades: { multiplier: 1, autoclicker: 0, autoclickerPower: 1 },
                        lastClickTime: 0,
                        clickCooldown: 100,
                        leaderboard: [],
                        totalPlayers: 0,
                        serverOnline: false
                    };
                    
                    if (autoclickerInterval) {
                        clearInterval(autoclickerInterval);
                        autoclickerInterval = null;
                    }
                    
                    updateUI();
                    loadGameProgress();
                    showNotification('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞! ‚úÖ');
                }
            }

            function createGameInterface() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="container">
                        <div class="header">
                            <h1>üéÆ –ü—Ä–æ –ö–ª–∏–∫–µ—Ä</h1>
                            <div class="stats">
                                <div>–û—á–∫–∏: <span id="score">0</span></div>
                                <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
                                <div>–ó–∞ –∫–ª–∏–∫: <span id="cpt">1</span></div>
                                <div id="autoclicker-info" class="autoclicker-info">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: +0/—Å–µ–∫</div>
                                <div id="server-status" class="server-status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...</div>
                            </div>
                        </div>

                        <div class="game-area">
                            <button id="click-btn" class="click-button">üéØ –ö–õ–ò–ö!</button>
                            <div style="text-align: center; margin-top: 10px;">
                                <button class="reset-btn" onclick="resetGame()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
                            </div>
                        </div>

                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</button>
                            <button class="tab-btn" data-tab="leaderboard">–õ–∏–¥–µ—Ä—ã</button>
                        </div>

                        <div id="upgrades-tab" class="tab-content active">
                            <div class="upgrades">
                                <h3>‚ö° –£–ª—É—á—à–µ–Ω–∏—è</h3>
                                <button class="upgrade-btn" id="upgrade-click-power">
                                    üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞ x2<br>
                                    <small>–°—Ç–æ–∏–º–æ—Å—Ç—å: 150</small>
                                </button>
                                <button class="upgrade-btn" id="upgrade-multiplier">
                                    üî• –ú–Ω–æ–∂–∏—Ç–µ–ª—å x2<br>
                                    <small>–°—Ç–æ–∏–º–æ—Å—Ç—å: 50</small>
                                </button>
                                <button class="upgrade-btn" id="upgrade-autoclicker">
                                    ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä +1<br>
                                    <small>–°—Ç–æ–∏–º–æ—Å—Ç—å: 100</small>
                                </button>
                                <button class="upgrade-btn" id="upgrade-autoclicker-power">
                                    üöÄ –ú–æ—â–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ x2<br>
                                    <small>–°—Ç–æ–∏–º–æ—Å—Ç—å: 200</small>
                                </button>
                            </div>
                        </div>

                        <div id="leaderboard-tab" class="tab-content">
                            <div class="leaderboard">
                                <h3>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h3>
                                <div id="leaderboard-list">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã... ‚è≥</div>
                                <div id="leaderboard-stats" class="leaderboard-stats"></div>
                                <button class="refresh-btn" onclick="loadGameProgress()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            function startGameFeatures() {
                startAutoclicker();
                setupUpgrades();
                setupTabs();
                
                const clickButton = document.getElementById('click-btn');
                if (clickButton) {
                    clickButton.addEventListener('click', handleClick);
                    clickButton.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        handleClick(e);
                    });
                }
                
                // –°–¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
                window.loadGameProgress = loadGameProgress;
                window.resetGame = resetGame;
                
                console.log('‚úÖ –ò–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—â–µ–Ω–∞');
            }

            // üöÄ –ó–ê–ü–£–°–ö–ê–ï–ú –ò–ì–†–£ - –°–ù–ê–ß–ê–õ–ê –ì–†–£–ó–ò–ú –ü–†–û–ì–†–ï–°–°, –ü–û–¢–û–ú –í–°–ï –û–°–¢–ê–õ–¨–ù–û–ï
            async function startGame() {
                console.log('üéØ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–≥—Ä—ã...');
                
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–∞
                await loadGameProgress();
                
                // –ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
                startGameFeatures();
                
                console.log('‚úÖ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞!');
            }

            startGame();
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            initTelegramApp();
        });
    </script>
</body>
</html>