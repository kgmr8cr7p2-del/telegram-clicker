<script>
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
        score: 0,
        level: 1,
        clicksPerTap: 1,
        playerName: "–ò–≥—Ä–æ–∫"
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const scoreElement = document.getElementById('score');
    const levelElement = document.getElementById('level');
    const clicksPerTapElement = document.getElementById('cpt');
    const clickButton = document.getElementById('click-btn');

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    function loadGameState() {
        const saved = localStorage.getItem('clickerGame');
        if (saved) {
            gameState = JSON.parse(saved);
        }
        
        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –∏–∑ Telegram
        if (window.Telegram && Telegram.WebApp) {
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user) {
                gameState.playerName = user.first_name || "–ò–≥—Ä–æ–∫";
            }
        }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    function saveGameState() {
        localStorage.setItem('clickerGame', JSON.stringify(gameState));
        updateLeaderboard();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateUI() {
        scoreElement.textContent = gameState.score;
        levelElement.textContent = gameState.level;
        clicksPerTapElement.textContent = gameState.clicksPerTap;
        
        document.querySelectorAll('.upgrade-btn').forEach(btn => {
            const cost = parseInt(btn.dataset.cost);
            btn.disabled = gameState.score < cost;
        });
    }

    // –ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ (–Ω–∞ –æ—Å–Ω–æ–≤–µ localStorage)
    function updateLeaderboard() {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏—Ö –ª–∏–¥–µ—Ä–æ–≤
        let leaders = JSON.parse(localStorage.getItem('clickerLeaders') || '[]');
        
        // –î–æ–±–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        const playerIndex = leaders.findIndex(p => p.name === gameState.playerName);
        if (playerIndex !== -1) {
            if (gameState.score > leaders[playerIndex].score) {
                leaders[playerIndex].score = gameState.score;
            }
        } else {
            leaders.push({
                name: gameState.playerName,
                score: gameState.score
            });
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º
        leaders.sort((a, b) => b.score - a.score);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-5
        leaders = leaders.slice(0, 5);
        localStorage.setItem('clickerLeaders', JSON.stringify(leaders));
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
        showLeaderboard(leaders);
    }

    function showLeaderboard(leaders) {
        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –±–ª–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
        let leaderboardEl = document.getElementById('leaderboard');
        if (!leaderboardEl) {
            leaderboardEl = document.createElement('div');
            leaderboardEl.id = 'leaderboard';
            leaderboardEl.innerHTML = '<h3>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h3>';
            document.querySelector('.container').appendChild(leaderboardEl);
        }
        
        leaderboardEl.innerHTML = '<h3>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h3>' + 
            leaders.map((player, index) => `
                <div style="margin: 5px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    ${index + 1}. ${player.name}: ${player.score} –æ—á–∫–æ–≤
                </div>
            `).join('');
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    function handleClick() {
        gameState.score += gameState.clicksPerTap;
        
        if (gameState.score >= gameState.level * 50) {
            gameState.level++;
            alert(`üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å! –¢–µ–ø–µ—Ä—å –≤—ã ${gameState.level} —É—Ä–æ–≤–Ω—è!`);
        }
        
        saveGameState();
        updateUI();
        
        clickButton.style.transform = 'scale(0.95)';
        setTimeout(() => {
            clickButton.style.transform = 'scale(1)';
        }, 100);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
    function setupUpgrades() {
        document.querySelectorAll('.upgrade-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const cost = parseInt(this.dataset.cost);
                const type = this.dataset.type;
                
                if (gameState.score >= cost) {
                    gameState.score -= cost;
                    
                    switch(type) {
                        case 'double':
                            gameState.clicksPerTap *= 2;
                            break;
                        case 'triple':
                            gameState.clicksPerTap *= 3;
                            break;
                        case 'mega':
                            gameState.clicksPerTap *= 5;
                            break;
                    }
                    
                    const newCost = cost * 2;
                    this.dataset.cost = newCost;
                    this.querySelector('span').textContent = newCost;
                    
                    saveGameState();
                    updateUI();
                    
                    alert(`‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –∫–ª–∏–∫ –¥–∞–µ—Ç: ${gameState.clicksPerTap}`);
                }
            });
        });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function initGame() {
        loadGameState();
        updateUI();
        updateLeaderboard(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        
        clickButton.addEventListener('click', handleClick);
        setupUpgrades();
        
        console.log('üéÆ –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ò–≥—Ä–æ–∫:', gameState.playerName);
    }

    document.addEventListener('DOMContentLoaded', initGame);
</script>